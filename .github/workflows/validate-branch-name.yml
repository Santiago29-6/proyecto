name: Validate branch name

on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - '**'

jobs:
  validate-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Debug event and refs
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "GITHUB_REF: $GITHUB_REF"
          echo "github.ref_name: ${{ github.ref_name }}"
          echo "github.head_ref: ${{ github.head_ref }}"

      - name: Get branch name
        id: get_branch
        env:
          EVENT_NAME: ${{ github.event_name }}
          HEAD_REF: ${{ github.head_ref }}
          REF: ${{ github.ref }}
        run: |
          if [[ "$EVENT_NAME" == "pull_request" ]]; then
            echo "branch_name=$HEAD_REF" >> $GITHUB_OUTPUT
          else
            echo "branch_name=${REF#refs/heads/}" >> $GITHUB_OUTPUT
          fi

      - name: Validate branch name
        run: |
          BRANCH_NAME="${{ steps.get_branch.outputs.branch_name }}"
          echo "Validating branch name: $BRANCH_NAME"
          if [[ ! "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|release|refactor)/.+$ ]]; then
            echo "❌ Invalid branch name: '$BRANCH_NAME'"
            echo "Branch name must start with one of the following prefixes: feature/, bugfix/, hotfix/, release/, or refactor/"
            exit 1
          else
            echo "✅ Branch name is valid."
          fi
